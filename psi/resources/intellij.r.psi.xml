<idea-plugin>
  <dependencies>
    <plugin id="org.intellij.plugins.markdown"/>
    <module name="intellij.platform.langInjection"/>
    <!-- region Generated dependencies - run `Generate Product Layouts` to regenerate -->
    <module name="intellij.libraries.grpc"/>
    <!-- endregion -->
  </dependencies>

  <!--<extensionPoints>-->
  <!--  <extensionPoint qualifiedName="com.intellij.rInterpreterSettingsProvider"-->
  <!--                  interface="com.intellij.r.psi.settings.RInterpreterSettingsProvider" dynamic="true"/>-->
  <!--  <extensionPoint qualifiedName="org.jetbrains.r.librarySupportProvider"-->
  <!--                  interface="com.intellij.r.psi.codeInsight.libraries.RLibrarySupportProvider" dynamic="true"/>-->
  <!--  <extensionPoint qualifiedName="org.jetbrains.r.tableContextProvider"-->
  <!--                  interface="com.intellij.r.psi.codeInsight.table.RTableContextManager" dynamic="true"/>-->
  <!--</extensionPoints>-->

  <extensions defaultExtensionNs="com.intellij">
    <!-- Registry keys -->
    <registryKey defaultValue="120000" key="r.interpreter.defaultTimeout" description="Default timeout for R interpreter operations"/>
    <registryKey defaultValue="30000" key="r.interpreter.initializedTimeout" description="Timeout for initializing Rwrapper"/>

    <!-- TODO: Temporarily commented out to avoid duplicate registration with R4Intellij (see DS FUS scheme generation failure).
         Proper fix: add <incompatible-with>R4Intellij</incompatible-with> to R Next plugin.xml -->
    <!--<rInterpreterSettingsProvider implementation="com.intellij.r.psi.settings.RLocalInterpreterSettingsProvider"/>-->

    <fileType name="R" implementationClass="com.intellij.r.psi.RFileType" fieldName="INSTANCE" language="R" extensions="R;Rprofile"/>
    <fileType name="RMarkdown" implementationClass="com.intellij.r.psi.rmarkdown.RMarkdownFileType" fieldName="INSTANCE"
              language="RMarkdown" extensions="Rmd"/>
    <fileType name="Roxygen" implementationClass="com.intellij.r.psi.roxygen.RoxygenFileType" fieldName="INSTANCE" language="Roxygen"/>
    <lang.syntaxHighlighterFactory language="R"
                                   implementationClass="com.intellij.r.psi.highlighting.RSyntaxHighlighterFactory"/>
    <highlightVisitor implementation="com.intellij.r.psi.highlighting.RRainbowVisitor"/>
    <lang.syntaxHighlighter language="Roxygen" implementationClass="com.intellij.r.psi.roxygen.RoxygenSyntaxHighlighter"/>

    <!-- Code style and formatting -->
    <colorSettingsPage implementation="com.intellij.r.psi.highlighting.RColorSettingsPage"/>
    <colorSettingsPage implementation="com.intellij.r.psi.highlighting.RMarkdownColorSettingsPage"/>
    <annotator language="R" implementationClass="com.intellij.r.psi.annotator.RAnnotator"/>

    <!-- Codeinsight -->

    <lang.ast.factory language="R" implementationClass="com.intellij.r.psi.parsing.RAstFactory"/>
    <lang.ast.factory language="Roxygen" implementationClass="com.intellij.r.psi.roxygen.parsing.RoxygenAstFactory"/>

    <lang.parserDefinition language="R" implementationClass="com.intellij.r.psi.parsing.RParserDefinition"/>
    <!--<lang.parserDefinition language="RMarkdown" implementationClass="org.jetbrains.r.rmarkdown.RMarkdownParserDefinition"/>-->
    <!--<lang.parserDefinition language="Quarto" implementationClass="org.jetbrains.r.quarto.QuartoParserDefinition"/>-->
    <lang.parserDefinition language="Roxygen" implementationClass="com.intellij.r.psi.roxygen.parsing.RoxygenParserDefinition"/>

    <languageInjector implementation="com.intellij.r.psi.roxygen.RoxygenLanguageInjector"/>

    <lang.tokenSeparatorGenerator language="R" implementationClass="com.intellij.r.psi.RTokenSeparatorGenerator"/>

    <!--<fileEditorProvider implementation="org.jetbrains.r.rendering.editor.RFileEditorProvider"/>-->
    <!--<fileEditorProvider implementation="org.jetbrains.r.run.visualize.RTableEditorProvider"/>-->

    <stubIndex implementation="com.intellij.r.psi.psi.stubs.RAssignmentNameIndex"/>
    <stubIndex implementation="com.intellij.r.psi.psi.stubs.RAssignmentCompletionIndex"/>
    <stubIndex implementation="com.intellij.r.psi.psi.stubs.RInternalAssignmentCompletionIndex"/>
    <stubIndex implementation="com.intellij.r.psi.psi.stubs.classes.RS4ClassNameIndex"/>
    <stubIndex implementation="com.intellij.r.psi.psi.stubs.classes.RS4GenericIndex"/>
    <stubIndex implementation="com.intellij.r.psi.psi.stubs.classes.RS4MethodsIndex"/>
    <stubIndex implementation="com.intellij.r.psi.psi.stubs.classes.R6ClassNameIndex"/>
    <stubElementTypeHolder class="com.intellij.r.psi.parsing.RElementTypes"/>

    <!--<lang.commenter language="R" implementationClass="org.jetbrains.r.editor.RCommenter"/>-->
    <!--<lang.commenter language="Roxygen" implementationClass="org.jetbrains.r.roxygen.usage.RoxygenCommenter"/>-->
    <!--<enterHandlerDelegate implementation="org.jetbrains.r.editor.REnterAdapter"/>-->
    <enterHandlerDelegate implementation="com.intellij.r.psi.roxygen.RoxygenEnterInLineCommentHandler"/>
    <enterHandlerDelegate implementation="com.intellij.r.psi.roxygen.RoxygenEnterDelegateToHostHandler" order="last"/>
    <!--<backspaceHandlerDelegate implementation="org.jetbrains.r.editor.RBackspaceHandler"/>-->

    <lang.findUsagesProvider implementationClass="com.intellij.r.psi.psi.references.RFindUsagesProvider" language="R"/>
    <!--<lang.findUsagesProvider implementationClass="org.jetbrains.r.roxygen.usage.RoxygenFindUsagesProvider" language="Roxygen"/>-->
    <elementDescriptionProvider implementation="com.intellij.r.psi.psi.references.RPomTargetDescriptionProvider"/>
    <elementDescriptionProvider implementation="com.intellij.r.psi.classes.s4.RS4PomTargetDescriptionProvider"/>
    <!--<usageTypeProvider implementation="org.jetbrains.r.roxygen.usage.RoxygenUsageTypeProvider"/>-->
    <!--<targetElementEvaluator language="R" implementationClass="org.jetbrains.r.codeInsight.findUsages.RTargetElementEvaluator"/>-->

    <!--<extendWordSelectionHandler implementation="org.jetbrains.r.editor.RExtendWordSelectionHandler"/>-->
    <!--<basicWordSelectionFilter implementation="org.jetbrains.r.editor.RExtendWordSelectionHandler$RBasicFilter"/>-->

    <!--<breadcrumbsInfoProvider implementation="org.jetbrains.r.breadcrumbs.RBreadcrumbsProvider"/>-->
    <!--<fileBreadcrumbsCollector implementation="org.jetbrains.r.breadcrumbs.RFileBreadcrumbsCollector" order="first"/>-->

    <controlFlowProvider implementation="com.intellij.r.psi.psi.cfg.RControlFlowProvider"/>

    <psi.referenceContributor language="R" implementation="com.intellij.r.psi.psi.references.RReferenceContributor"/>
    <psi.referenceContributor language="R" implementation="com.intellij.r.psi.classes.s4.RS4ReferenceContributor"/>
    <referencesSearch implementation="com.intellij.r.psi.classes.s4.RS4ReferenceSearcher"/>

    <!--<typedHandler implementation="org.jetbrains.r.editor.RCompletionAutoPopupHandler" order="first, before completionAutoPopup"/>-->
    <!--<typedHandler implementation="org.jetbrains.r.roxygen.RoxygenTypedHandler"/>-->
    <!--<lookup.charFilter implementation="org.jetbrains.r.editor.RCharFilter" order="first"/>-->
    <!--<targetElementEvaluator language="R" implementationClass="org.jetbrains.r.editor.RTargetElementEvaluator"/>-->
    <!--<editorSmartKeysConfigurable instance="org.jetbrains.r.editor.RSmartKeys"-->
    <!--                             id="editor.preferences.rOptions"-->
    <!--                             displayName="R"/>-->

    <filetype.stubBuilder filetype="RPluginSkeletonFile" implementationClass="com.intellij.r.psi.skeleton.RSkeletonFileStubBuilder"/>
    <fileType.fileViewProviderFactory filetype="RPluginSkeletonFile" implementationClass="com.intellij.r.psi.skeleton.RSkeletonViewProviderFactory"/>
    <stubElementTypeHolder class="com.intellij.r.psi.skeleton.psi.RSkeletonElementTypes"/>
    <fileType extensions="RPluginSkeletonFile" name="RPluginSkeletonFile" fieldName="INSTANCE" implementationClass="com.intellij.r.psi.skeleton.RSkeletonFileType"/>

    <!-- Settings -->
    <projectConfigurable groupId="project"
                         id="com.intellij.r.psi.configuration.RSettingsProjectConfigurable"
                         bundle="messages.RPluginBundle"
                         key="r.settings"
                         instance="com.intellij.r.psi.configuration.RSettingsProjectConfigurable"/>

    <applicationService serviceImplementation="com.intellij.r.psi.settings.RInterpreterSettings"/>
  </extensions>
</idea-plugin>